angular.module("linkmanApp",["ngAnimate","ui.router","firebase","cfp.hotkeys"]).constant("FBURL","https://linkman.firebaseio.com/links").factory("fbService",["$firebaseArray","FBURL",function($firebaseArray,FBURL){var ref=new Firebase(FBURL);return $firebaseArray(ref)}]).service("hotkey",["hotkeys","$state",function(hotkeys,$state){this.run=function($scope){hotkeys.bindTo($scope).add({combo:"esc",callback:function(){$state.go("links")}}).add({combo:"n",callback:function(){$state.go("links.add")}}).add({combo:"v",callback:function(){$state.go("links.add")}})}}]).config(["$stateProvider","$urlRouterProvider","$locationProvider",function($stateProvider,$urlRouterProvider,$locationProvider){$stateProvider.state("links",{url:"/link",templateUrl:"views/link-list.html",controller:"ListController"}).state("links.add",{url:"/add",templateUrl:"views/link-add.html",controller:"AddLinkController"}).state("links.edit",{url:"/:id",templateUrl:"views/link-edit.html",controller:"EditController"}),$urlRouterProvider.otherwise("/link"),$locationProvider.html5Mode(!0)}]).controller("AppController",["$scope","fbService","$state","hotkey","$rootScope",function($scope,fbService,$state,hotkey,$rootScope){$scope.showpreloader=!0,$scope.showmask=!1,$scope.state=$state,$scope.openAddLink=function(){$state.go("links.add")},$scope.openEditLink=function(){$state.go("links.edit")},$scope.$on("showpreloader",function(event,show){$scope.showpreloader=show}),$rootScope.$on("$stateChangeStart",function(event,toState){"links"==toState.name?$scope.showmask=!1:"links.add"==toState.name?$scope.showmask=!0:"links.edit"==toState.name&&($scope.showmask=!0)}),hotkey.run($scope)}]).controller("ListController",["$scope","fbService",function($scope,fbService){$scope.links=fbService,$scope.links.$loaded().then(function(){$scope.$emit("showpreloader",!1)})}]).controller("AddLinkController",["$scope","fbService","$state",function($scope,fbService,$state){$scope.submit=function(){$scope.addForm.$invalid||($scope.$emit("showpreloader",!0),fbService.$add({title:$scope.title,url:$scope.url,tags:$scope.tags,fav:!1}).then(function(){$scope.$emit("showpreloader",!1),$state.go("links")}))},$scope.cancel=function(){$state.go("links")}}]).controller("EditController",["$scope","fbService","$state","$stateParams",function($scope,fbService,$state,$stateParams){$scope.master=$scope.links.$getRecord($stateParams.id),$scope.link=angular.copy($scope.master),$scope.save=function(){$scope.editForm.$invalid||($scope.$emit("showpreloader",!0),angular.copy($scope.link,$scope.master),fbService.$save($scope.master).then(function(){$scope.$emit("showpreloader",!1),$state.go("links")}))},$scope.cancel=function(){$state.go("links")}}]);